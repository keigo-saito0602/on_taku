<div class="flex items-center justify-between gap-4">
  <div>
    <h1 class="text-2xl font-semibold text-slate-900"><%= @discount.name %></h1>
    <p class="mt-1 text-sm text-slate-500">割引の詳細情報と適用順序を確認できます。</p>
  </div>
  <div class="flex items-center gap-3">
    <%= link_to "一覧へ戻る", discounts_path, class: "inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 transition hover:bg-slate-50" %>
    <%= link_to "編集", edit_discount_path(@discount), class: "inline-flex items-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-sky-500" %>
    <%= button_to "削除", @discount, method: :delete,
          form: { data: { turbo_confirm: "割引「#{@discount.name}」を削除しますか？" } },
          class: "inline-flex items-center rounded-lg bg-rose-600 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-rose-500" %>
  </div>
</div>

<div class="mt-6 grid gap-6 lg:grid-cols-2">
  <section class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
    <h2 class="text-lg font-semibold text-slate-800">基本情報</h2>
    <dl class="mt-4 space-y-3 text-sm">
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">カテゴリ</dt>
        <dd class="font-medium text-slate-800"><%= @discount.category_label %></dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">適用範囲</dt>
        <dd class="font-medium text-slate-800"><%= @discount.scope_label %></dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">割引方式</dt>
        <dd class="font-medium text-slate-800">
          <% if @discount.kind_percentage? %>
            割合（%）
          <% elsif @discount.kind_fixed? %>
            固定額（円）
          <% else %>
            特典 / その他
          <% end %>
        </dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">割引値</dt>
        <dd class="font-medium text-slate-800">
          <% if @discount.kind_percentage? %>
            <%= @discount.value %>%
          <% elsif @discount.kind_fixed? %>
            ¥<%= number_with_delimiter(@discount.value) %>
          <% else %>
            -
          <% end %>
        </dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">適用順</dt>
        <dd class="font-medium text-slate-800"><%= @discount.priority %></dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">併用ルール</dt>
        <dd>
          <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600"><%= @discount.stacking_label %></span>
        </dd>
      </div>
      <div class="flex items-baseline justify-between">
        <dt class="text-slate-500">公開状態</dt>
        <% status = @discount.status %>
        <% tone =
             case status
             when :active then "bg-emerald-100 text-emerald-700"
             when :upcoming then "bg-amber-100 text-amber-700"
             when :expired then "bg-rose-100 text-rose-700"
             else "bg-slate-200 text-slate-600"
             end %>
        <dd>
          <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold <%= tone %>"><%= @discount.status_label %></span>
        </dd>
      </div>
      <div>
        <dt class="text-slate-500">適用期間</dt>
        <dd class="mt-1 text-slate-600">
          <%= @discount.start_at&.strftime("%Y/%m/%d %H:%M") || "設定なし" %> 〜
          <%= @discount.end_at&.strftime("%Y/%m/%d %H:%M") || "設定なし" %>
        </dd>
      </div>
      <div>
        <dt class="text-slate-500">説明</dt>
        <dd class="mt-1 text-slate-600"><%= @discount.description.presence || "説明は登録されていません。" %></dd>
      </div>
    </dl>
  </section>

  <section class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
    <h2 class="text-lg font-semibold text-slate-800">適用イベント</h2>
    <% if @discount.events.exists? %>
      <ul class="mt-4 space-y-2 text-sm text-slate-700">
        <% @discount.events.order(:event_date).each do |event| %>
          <li class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2">
            <%= link_to "#{l(event.event_date)} #{event.name}", event, class: "font-medium text-sky-600 hover:text-sky-500" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="mt-4 rounded-lg bg-slate-50 px-3 py-3 text-sm text-slate-500">この割引が適用されているイベントはありません。</p>
    <% end %>
  </section>
</div>

<section class="mt-6 rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
  <h2 class="text-lg font-semibold text-slate-800">適用条件</h2>
  <div class="mt-4 grid gap-4 md:grid-cols-2">
    <div>
      <div class="text-xs font-semibold uppercase tracking-wide text-slate-500">最低対象金額</div>
      <div class="mt-1 text-sm font-medium text-slate-800"><%= @discount.minimum_amount.positive? ? "¥#{number_with_delimiter(@discount.minimum_amount)}" : "指定なし" %></div>
    </div>
    <div>
      <div class="text-xs font-semibold uppercase tracking-wide text-slate-500">最低数量</div>
      <div class="mt-1 text-sm font-medium text-slate-800"><%= @discount.minimum_quantity.positive? ? "#{@discount.minimum_quantity} 件" : "指定なし" %></div>
    </div>
    <div>
      <div class="text-xs font-semibold uppercase tracking-wide text-slate-500">ユーザー上限</div>
      <div class="mt-1 text-sm font-medium text-slate-800"><%= @discount.usage_limit_per_user.positive? ? "#{@discount.usage_limit_per_user} 回" : "無制限" %></div>
    </div>
    <div>
      <div class="text-xs font-semibold uppercase tracking-wide text-slate-500">イベント全体上限</div>
      <div class="mt-1 text-sm font-medium text-slate-800"><%= @discount.usage_limit_total.positive? ? "#{@discount.usage_limit_total} 回" : "無制限" %></div>
    </div>
  </div>
</section>
