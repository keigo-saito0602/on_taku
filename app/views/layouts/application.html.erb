<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "音卓（ON Taku）" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="音卓（ON Taku）">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Manifest will be wired in once the PWA route is enabled %>

    <link rel="icon" href="<%= asset_path('on_taku-icon.png') %>" type="image/png">
    <link rel="icon" href="<%= asset_path('on_taku-icon.svg') %>" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/on_taku-icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-slate-100 text-slate-900">
    <header class="bg-slate-900 text-white">
      <nav class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
        <div class="flex items-center gap-6 text-sm font-medium">
          <%= link_to "イベント一覧", events_path, class: "transition hover:text-sky-200" %>
          <% if current_user %>
            <%= link_to "アーティスト", artists_path, class: "transition hover:text-sky-200" %>
            <% if current_user.organizer? %>
              <%= link_to "割引", discounts_path, class: "transition hover:text-sky-200" %>
            <% end %>
          <% end %>
        </div>
        <div class="flex items-center gap-4 text-sm">
          <% if current_user %>
            <%= link_to current_user.display_name, account_path, class: "inline-flex items-center gap-2 rounded-full bg-slate-800 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide transition hover:bg-slate-700" %>
          <% else %>
            <%= link_to "ログイン", new_session_path, class: "rounded-md bg-sky-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-sky-400" %>
          <% end %>
        </div>
      </nav>
    </header>

    <% if flash[:alert_dialog].present? %>
      <div data-controller="flash-dialog"
           data-flash-dialog-title-value="<%= j(flash[:alert_dialog_title].presence || '公開できません') %>"
           data-flash-dialog-message-value="<%= j(flash[:alert_dialog]) %>"></div>
    <% end %>

    <main class="mx-auto flex max-w-6xl flex-col gap-6 px-4 py-8">
      <% flash.each do |type, message| %>
        <% next if type.to_s.in?(%w[alert_dialog alert_dialog_title]) %>
        <% tone = type.to_s.in?(%w[notice success]) ? "bg-emerald-50 text-emerald-800 border border-emerald-200" : "bg-rose-50 text-rose-800 border border-rose-200" %>
        <div class="rounded-lg px-4 py-3 text-sm font-medium <%= tone %>">
          <%= message %>
        </div>
      <% end %>

      <%= yield %>
    </main>
  </body>
</html>
